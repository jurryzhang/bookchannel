<include file="Public/min-header"/>    <link type="text/css" rel="stylesheet" href="__PUBLIC__/js/jedate/skin/jedate.css">    <script type="text/javascript" src="__PUBLIC__/js/jedate/jquery.jedate.js"></script>    <style>        .fileinput-button {            position: relative;            display: inline-block;            overflow: hidden;        }        .fileinput-button input{            position: absolute;            left: 0px;            top: 0px;            opacity: 0;            -ms-filter: 'alpha(opacity=0.5)';        }    </style></head><body style="background-color:#ecf0f5;display:block;overflow:auto;margin:0 auto;"><!--公共js 代码 --><script src="__PUBLIC__/js/common.js" charset="utf-8"        type="text/javascript"></script><!--公共js end代码 --><link href="__PUBLIC__/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" /><script src="__PUBLIC__/plugins/daterangepicker/moment.min.js" type="text/javascript"></script><script src="__PUBLIC__/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script><div class="wrapper">    <include file="Public/breadcrumb" />    <section class="content">        <!-- Main content -->        <div class="container-fluid">            <div class="pull-right">                <a href="javascript:history.go(-1)" data-toggle="tooltip" title=""                   class="btn btn-default" data-original-title="返回"> <i                        class="fa fa-reply"> </i>                </a>            </div>            <div class="panel panel-default">                <div class="panel-heading">                    <h3 class="panel-title">                        <i class="fa fa-list"> </i>                            添加广告                    </h3>                </div>                <div class="panel-body">                    <!--表单数据-->                    <form method="post"  enctype="multipart/form-data" id="adAdd" action="__CONTROLLER__/adAdd.html">                        <div class="form-group" style="margin: 25px 10px 10px 25px;padding-left: 80px;">                            <label class="control-label " style="text-align: center ;margin-left:20px;">请选择广告类型:</label>                            <select id="adtype" name="adtype" class="form-control" style="width: 250px; margin-top:-20px;margin-left:10px;display: inline-block;">                                <option value="0">请选择广告类型</option>                                <option value="1">微信关注卡</option>                                <option value="2">图文广告</option>                                <option value="3">图片广告</option>                            </select>                            <span id="tplinfo" style="color:#009933;font-size: 13px; font-weight: bold"></span>                        </div>                        <!--通用信息-->                        <div class="tab-content" id="adtable" style="display:none">                            <div class="tab-pane active" id="tab_tongyong">                                <table class="table table-bordered" >                                    <tbody >                                    <tr >                                        <td class="text-center" id="titlelable">                                           广告标题:                                        </td>                                        <td>                                            <input type="text" value="" name="title" id='title' placeholder="请填写广告标题" class="form-control" style="width: 350px; display: inline-block" />                                            <span id="err_ptname" style="color: #F00;">                                                </span>                                        </td>                                    </tr>                                    <tr id="contentlable">                                        <td class="text-center" >                                            引导文案:                                        </td>                                        <td>                                            <input type="text" value="" name="content" id='content' placeholder="引导文案(18个字以内)" class="form-control" style="width: 350px; display: inline-block" />                                        </td>                                    </tr>                                    <tr>                                        <td class="text-center">                                            上传图片:                                        </td>                                        <td>                                              <span class="btn btn-success fileinput-button">                                                  <span>上传图片</span>                                                   <input type="file" id="pic" name="pic" onchange="upload()">                                              </span>                                            <p style="margin-top: 5px;color: #848484">图片尺寸：<span id="imagesize">114*114</span>像素<br/>                                                图片规格：支持png, jpeg, jpg格式，不超过1Mb</p>                                            <!--<input type="file" name="pic" id="pic" onchange="upload()">-->                                            <div id="spic" style=";color:#009933 " >                                                <img src="" id="uppic" style="width: 100px;display: none  ">                                                <span style="height:60px;vertical-align: bottom; font-weight: bold; display: none " id="picinfo" >上传成功!</span>                                            </div>                                            <div class="progress progress-xs progress-striped active" id="progress" style="width:250px;display:none">                                                <div class="progress-bar progress-bar-success" id="probar" style="width: 0%"></div>                                            </div>                                            <span class="badge bg-green" style="display: none" id="procount"> 0%</span>                                            <input type="hidden" name="picurl" id="picurl" value="">                                        </td>                                    </tr>                                    <tr>                                        <td class="text-center">                                            广告推广时间:                                        </td>                                        <td>                                            <input type="text"  id="date01" name="starttime"  class="form-control" style="width: 170px; display: inline-block" /> 到                                            <input type="text"  id="date02" name="endtime"  class="form-control" style="width: 170px; display: inline-block" />                                        </td>                                    </tr>                                    <tr>                                        <td class="text-center" id="urllable">                                            点击跳转链接：                                        </td>                                        <td>                                            <input type="text" value="" name="url" id='url' placeholder="请填写要跳转的链接地址" class="form-control" style="width: 450px; display: inline-block" />                                            <p style="display: none;color:red;margin-top: 5px;" id="wxurl">url必须以http://或https://开头,如果没有上传图片或者没有引导关注的链接,<br/>请填写正确的微信号,系统会自动生成二维码图片和引导关注页面</p>                                        </td>                                    </tr>                                    <tbody />                                </table>                            </div>                        </div>                        <div class="text-center">                            <input class="btn btn-primary" onclick="saveAction()" title="" value="保存" type="submit">                            <a href="javascript:history.go(-1)" data-toggle="tooltip" title=""                               class="btn btn-default" data-original-title="返回"> 取消                            </a>                        </div>                    </form>                    <!--表单数据-->                </div>            </div>        </div>    </section></div><script>    var save=false;    //选择不同广告类型,显示不通模版    var type=0;    $('#adtype').change(function () {        type=$('#adtype option:selected').val();        if(type==1){            $('#titlelable').html(' 微信公众号名称:');            $('#title').attr('placeholder','请填写微信公众号名称');            $('#urllable').html('微信引导关注链接：');            $('#url').attr('placeholder','填写微信引导关注的页面url或者微信号');            $('#wxurl').css('display','');        }else{            $('#titlelable').html(' 广告标题:');            $('#title').attr('placeholder','请填写广告标题');            $('#urllable').html(' 点击跳转链接：');            $('#url').attr('placeholder','请填写要跳转的链接地址');            $('#wxurl').css('display','none');        }        //如果是图片消息不显示文案        if(type==3){            $('#contentlable').css('display','none');            $('#imagesize').html('582*166');        }else{            $('#contentlable').css('display','');            $('#imagesize').html('114*114');        }        if(type==2){            $('#content').attr('placeholder','引导文案(28个字以内)');        }else{            $('#content').attr('placeholder','引导文案(18个字以内)');        }        //如果是请选择就不显示表格        if(type==0){            $('#adtable').css('display','none');        }else {            $('#adtable').css('display','block');        }    });        $("#date01").jeDate({            isinitVal:true,            festival:true,            ishmsVal:false,            minDate: $.nowDate(0),            maxDate: '2099-06-16 23:59:59',            format:"YYYY-MM-DD hh:mm:ss",            zIndex:3000        });        $("#date02").jeDate({            isinitVal:true,            festival:true,            ishmsVal:false,            minDate: $.nowDate(0),            maxDate: '2099-06-16 23:59:59',            format:"YYYY-MM-DD hh:mm:ss",            zIndex:3000        });</script><script>    //上传图片    function upload(del){        if(del==1){            $('#uppic').css('display','');        }else {            $('#uppic').css('display','none');        }        var fm = document.getElementById('adAdd');        //① 收集用户输入的表单域信息[FormData]        var fd = new FormData(fm);//普通表单域 + 上传文件域信息        //② 并把收集的信息提交给服务器端[ajax]        var xhr = new XMLHttpRequest();        xhr.onreadystatechange = function(){            if(xhr.readyState==4){                var str='';                eval('str='+xhr.responseText);                //console.log(str);                if(str.error==1){                    $('#picinfo').css('display','');                    $('#picinfo').css('color','red');                    $('#picinfo').html(str.msg);                }else {                    $('#picurl').val(str.pic.urlpath);                    $('#uppic').css('display','');                    $('#uppic').attr('src',str.pic.urlpath);                    $('#picinfo').css('display','');                    $('#picinfo').html('上传成功!');                    $('#picinfo').css('color','#009933');                }            }        }        xhr.upload.onprogress = function(evt){            //该事件每间隔100ms左右就执行一次，            //并可以通过事件对象感知附件信息            //附件已经上传大小            var lod = evt.loaded;            //附件总大小            var tal = evt.total;            //上传百分比            if(del==1){                $('#progress').css('display','none');                $('#procount').css('display','none');            }else {                $('#progress').css('display','inline-block');                $('#procount').css('display','inline-block');            }            var per = Math.floor((lod/tal)*100) + "%";            //设置进度条            $('#procount').html(per);            $('#probar').css('width',per);        }        if(del==1){            xhr.open('post','/index.php/Ad/adPicUpload/del/1');        }else {            xhr.open('post','/index.php/Ad/adPicUpload');        }        xhr.send(fd);    }</script><script>    function saveAction(){        save=true;    }    window.onbeforeunload = function() {        return checksave();    }    function checksave() {        if(save==false){            upload(1);            return false ;        }    }</script></body></html>